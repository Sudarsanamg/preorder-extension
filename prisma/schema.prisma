// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

// Note that some adapters may set a maximum length for the String type by default, please ensure your strings are long
// enough when changing adapters.
// See https://www.prisma.io/docs/orm/reference/prisma-schema-reference#string for more information
datasource db {
  provider = "sqlite"
  url      = "file:dev.sqlite"
}

model Session {
  id            String    @id
  shop          String
  state         String
  isOnline      Boolean   @default(false)
  scope         String?
  expires       DateTime?
  accessToken   String
  userId        BigInt?
  firstName     String?
  lastName      String?
  email         String?
  accountOwner  Boolean   @default(false)
  locale        String?
  collaborator  Boolean?  @default(false)
  emailVerified Boolean?  @default(false)
}

model PreorderCampaign {
  id                 String                    @id @default(cuid())
  name               String
  depositPercent     Int // e.g. 30
  balanceDueDate     DateTime
  refundDeadlineDays Int? // e.g. 14
  releaseDate        DateTime?
  status             String                    @default("draft") // publish, unpublish, draft
  products           PreorderCampaignProduct[]
  preorders          Preorder[]
  campaignEndDate    DateTime
  totalOrders        Int                       @default(0)
  createdAt          DateTime                  @default(now())
  updatedAt          DateTime                  @updatedAt
}

model PreorderCampaignProduct {
  id           String           @id @default(cuid())
  campaignId   String
  campaign     PreorderCampaign @relation(fields: [campaignId], references: [id], onDelete: Cascade)
  productId    String
  variantId    String?
  maxQuantity  Int
  soldQuantity Int              @default(0)
  createdAt    DateTime         @default(now())
  updatedAt    DateTime         @updatedAt
}

model Preorder {
  id                   String           @id @default(cuid())
  campaignId           String
  campaign             PreorderCampaign @relation(fields: [campaignId], references: [id])
  productId            String
  variantId            String?
  customerId           String
  orderId              String // Shopify deposit order ID
  depositTransactionId String
  depositPaidAt        DateTime
  dueInvoiceSentAt     DateTime?
  balanceDueDays       Int
  refundDeadlineDays   Int
  status               String
  createdAt            DateTime         @default(now())
  updatedAt            DateTime         @updatedAt
}

model CampaignOrders {
  id             String   @id @default(cuid())
  order_number   Int
  order_id       String
  draft_order_id String
  dueDate        DateTime
  balanceAmount  Int
  paymentStatus  String
}
